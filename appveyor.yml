environment:
  GYP_MSVS_VERSION: 2013

  matrix:
    - node_version: '4.2.4'

install:
  - ps: Install-Product node $env:node_version $env:platform
  - ps: npm install -g node-gyp
  - ps: $publish_binary=0
  - ps: if ($env:appveyor_repo_tag -match "true" -and $env:appveyor_repo_tag_name -match '^v[0-9]') { $publish_binary=1; }

build_script:
  - ps: echo $publish_binary
  - ps: >
      & {
        $ErrorActionPreference = 'SilentlyContinue'
        git submodule update --init 2>&1 | write-host
        npm install --build-from-source 2>&1 | write-host
        ./node_modules/.bin/node-pre-gyp package 2>&1 | write-host
        if ($publish_binary) { ./node_modules/.bin/node-pre-gyp publish 2>&1 | write-host; }
      }

platform:
  - x86
  - x64
